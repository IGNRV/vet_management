<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- ===== Search ===== -->
    <record id="vaccination_search_view" model="ir.ui.view">
      <field name="name">animal.vaccination.search.view</field>
      <field name="model">animal.vaccination</field>
      <field name="arch" type="xml">
        <search string="Buscar registros de vacunación">
          <field name="animal_id" string="Animal"/>
          <field name="owner_id" string="Dueño"/>
          <field name="specie_id" string="Especie"/>
          <field name="vaccine_id" string="Vacuna"/>
          <field name="date" string="Fecha vacunación"/>
          <field name="next_date" string="Próxima vacunación"/>
          <field name="route" string="Vía"/>
          <field name="doctor" string="Dr/Dra"/>
          <field name="applied_doses" string="Dosis aplicadas"/>
          <field name="lot_number" string="Lote"/>
          <field name="lot_expiration" string="Vencimiento"/>
          <field name="notes" string="Notas/Observaciones"/>

          <group expand="0" string="Agrupar por">
            <filter name="grp_animal" string="Animal" context="{'group_by':'animal_id'}"/>
            <filter name="grp_owner" string="Dueño" context="{'group_by':'owner_id'}"/>
            <filter name="grp_specie" string="Especie" context="{'group_by':'specie_id'}"/>
            <filter name="grp_vaccine" string="Vacuna" context="{'group_by':'vaccine_id'}"/>
            <filter name="grp_route" string="Vía" context="{'group_by':'route'}"/>
            <filter name="grp_doctor" string="Dr/Dra" context="{'group_by':'doctor'}"/>
            <filter name="grp_date" string="Fecha (mes)" context="{'group_by':'date:month'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- ===== Tree ===== -->
    <record id="vaccination_tree_view" model="ir.ui.view">
      <field name="name">animal.vaccination.tree.view</field>
      <field name="model">animal.vaccination</field>
      <field name="arch" type="xml">
        <tree string="Registros de Vacunación">
          <field name="date" string="Fecha"/>
          <field name="animal_id" string="Animal"/>
          <field name="owner_id" string="Dueño"/>
          <field name="specie_id" string="Especie"/>
          <field name="vaccine_id" string="Vacuna"/>
          <field name="applied_doses" string="Dosis"/>
          <field name="route" string="Vía"/>
          <field name="doctor" string="Dr/Dra"/>
          <field name="next_date" string="Próx. vacunación"/>
          <field name="consume_stock" string="Desc. stock"/>
          <field name="lot_number" string="Lote"/>
          <field name="lot_expiration" string="Vencimiento"/>
          <field name="notes" string="Notas"/>
        </tree>
      </field>
    </record>

    <!-- ===== Form ===== -->
    <record id="vaccination_form_view" model="ir.ui.view">
      <field name="name">animal.vaccination.form.view</field>
      <field name="model">animal.vaccination</field>
      <field name="arch" type="xml">
        <form string="Registro de Vacunación">
          <header>
            <!-- Botón para descargar el PDF del registro -->
            <button name="%(action_report_vaccination)d"
                    type="action"
                    class="btn-primary"
                    string="Descargar PDF"/>
          </header>

          <sheet>
            <group>
              <group string="Datos del Animal">
                <field name="animal_id" required="1"/>
                <field name="owner_id" readonly="1"/>
                <field name="specie_id" readonly="1"/>
              </group>
              <group string="Vacunación">
                <field name="vaccine_id" required="1"/>
                <field name="date" required="1"/>
                <field name="applied_doses" string="Dosis aplicadas"/>
                <field name="consume_stock"/>
                <field name="route"/>
                <field name="doctor" string="Dr/Dra" placeholder="Nombre del profesional"/>
                <field name="next_date" string="Próxima vacunación"/>
              </group>
            </group>

            <group string="Lote / Observaciones">
              <field name="lot_number"/>
              <field name="lot_expiration"/>
              <field name="notes" placeholder="Notas u observaciones clínicas..."/>
            </group>
          </sheet>

          <div class="oe_chatter">
            <field widget="mail_thread" name="message_ids"/>
            <field widget="mail_activity" name="activity_ids"/>
          </div>
        </form>
      </field>
    </record>

    <!-- ===== Action (listado independiente) ===== -->
    <record id="vaccination_action" model="ir.actions.act_window">
      <field name="name">Registros de Vacunación</field>
      <field name="res_model">animal.vaccination</field>
      <field name="view_mode">search,tree,form,kanban</field>
    </record>

  </data>
</odoo>
